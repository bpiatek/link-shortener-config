logging:
  file:
    name: /tmp/log.log

spring:
  threads:
    virtual:
      enabled: true
  boot:
    admin:
      client:
        username: ${monitoring.user.name}
        password: ${monitoring.user.password}
        instance:
          service-url: http://link-shortener-api-gateway-dev-helm:80
          metadata:
            user.name: ${monitoring.user.name}
            user.password: ${monitoring.user.password}
  cloud:
    gateway:
      server:
        webmvc:
          not-found-on-dispatch-handler:
            enabled: true
          routes:
            # ==========================================
            # 1. API DOMAIN ROUTES (api.bpiatek.pl)
            # ==========================================

            - id: user_service_route
              uri: lb://link-shortener-user-service-dev-helm:8080
              order: 10
              predicates:
                - Host=apidev.bpiatek.pl
                - Path=/users/**
              filters:
                - StripPrefix=1

            - id: link_service_route
              uri: lb://link-shortener-link-service-dev-helm:8080
              order: 10
              predicates:
                - Host=apidev.bpiatek.pl
                - Path=/links/**
              # Preserved: No StripPrefix based on your previous config

            - id: dashboard_query_service_route
              uri: lb://link-shortener-dashboard-query-service-dev-helm:8080
              order: 10
              predicates:
                - Host=apidev.bpiatek.pl
                - Path=/dashboard/**

            - id: notification_service_route
              uri: lb://link-shortener-notification-service-dev-helm:8080
              order: 10
              predicates:
                - Host=apidev.bpiatek.pl
                - Path=/notifications/**

            # ==========================================
            # 2. UI SERVICE ROUTES (ls.bpiatek.pl)
            # ==========================================

            - id: ui_service_route
              uri: lb://link-shortener-ui-dev-helm:8080
              order: 1
              predicates:
                - Host=ls.bpiatek.pl
                # Explicitly list UI paths to avoid conflict with short codes
                - Path=/, /login, /sign-out, /inactive, /404, /register, /verify, /forgot-password, /reset-password, /dashboard/**, /css/**, /js/**, /images/**, /favicon.ico, /error, /forgot-password-pending, /registration-pending

            # ==========================================
            # 3. REDIRECT SERVICE (ls.bpiatek.pl Catch-All)
            # ==========================================

            - id: redirect_service_route
              uri: lb://link-shortener-redirect-service-dev-helm:8080
              order: 100 # Lowest priority
              predicates:
                - Host=ls.bpiatek.pl
                - Path=/**

  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: "http://link-shortener-user-service-dev-helm.dev.svc.cluster.local:8080/.well-known/jwks.json"

management:
  tracing:
    sampling:
      probability: 1.0
    otlp:
      tracing:
        endpoint: http://tempo.observability.svc.cluster.local:4318/v1/traces
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: ALWAYS
    env:
      show-values: ALWAYS
    logfile:
      access: read_only
    configprops:
      show-values: ALWAYS
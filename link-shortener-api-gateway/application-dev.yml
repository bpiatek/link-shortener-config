spring:
  threads:
    virtual:
      enabled: true
  boot:
    admin:
      client:
        username: ${monitoring.user.name}
        password: ${monitoring.user.password}
        instance:
          service-url: http://link-shortener-api-gateway-dev-helm:80
          metadata:
            user.name: ${monitoring.user.name}
            user.password: ${monitoring.user.password}
  cloud:
    gateway:
      server:
        webmvc:
          routes:
            - id: kafka_producer_route
              uri: lb://kafka-producer-dev-helm:8080
              order: 1
              predicates:
                - Path=/producer/**
              filters:
                - StripPrefix=1

            - id: kafka_consumer_route
              uri: lb://kafka-consumer-dev-helm:8080
              order: 1
              predicates:
                - Path=/consumer/**
              filters:
                - StripPrefix=1

            - id: user_service_route
              uri: lb://link-shortener-user-service-dev-helm:8080
              order: 1
              predicates:
                - Path=/users/**
              filters:
                - StripPrefix=1

            - id: link_service_route
              uri: lb://link-shortener-link-service-dev-helm:8080
              order: 1
              predicates:
                - Path=/links/**

            - id: redirect_service_route
              uri: lb://link-shortener-redirect-service-dev-helm:8080
              order: 100
              predicates:
                # It will match '/aB5xZ1' but NOT '/links/something'
                - Path=/{shortCode:[a-zA-Z0-9]+}

  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: "http://link-shortener-user-service-dev-helm.dev.svc.cluster.local:8080/.well-known/jwks.json"
server:
  undertow:
    threads:
      worker: 0
      io: 2

management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: ALWAYS
    env:
      show-values: ALWAYS